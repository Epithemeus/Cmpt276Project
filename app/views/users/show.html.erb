<%= render "shared/navbar" %>
<style>
  table, th, td{
   border: 1px solid black;
   border-collapse: collapse;
  } 
</style>
<p>
  <div>Add a Boardgame geek account to sync with here.</div>
  <%= form_tag(link_path, method: "get") do %>
    <div class="field">
      <%= label_tag(:account_name, "Account name") %>
      <%= text_field_tag(:account_name) %>
    </div>
    <%= submit_tag("Add Account") %>
  <% end %>
</p>

<% if Delayed::Job.exists? %>
  <div>We are currently processing an account for you, please note this may take a long time for large accounts (approximately 1 second per game), you can click below to refresh</div>
  <%= link_to "Refresh" %>
<% end %>

<% if @user.accounts.count > 0 and not Delayed::Job.exists? %>
  <table>
    <th>Account Name</th>
    <% for account in @user.accounts do %>
      <tr>
        <td><%= account %></td> 
        <td><%= link_to "Delete", unlink_path(:account => account), data: { confirm: "Are you sure?" } %></td>
      </tr>
    <% end %>
  </table>
  
  <p>
    <%#= form_tag do %>
      <%#= number_field_tag(:maxage, in: 1..100) %>
      <%#= submit_tag("Submit") %>
    <%# end %>
  </p>
  
  <table>
    <th><%= link_to "Name", params.merge(:sort => 'bgname') %></th>
    <th><%= link_to "Year", params.merge(:sort => 'yearpublished') %></th>
    <th><%= link_to "Minimum Age", params.merge(:sort => 'minage') %></th>
    <th><%= link_to "Min Players", params.merge(:sort => 'minplayers') %></th>
    <th><%= link_to "Max Players", params.merge(:sort => 'maxplayers') %></th>
    <th><%= link_to "Game Time", params.merge(:sort => 'playingtime') %></th>
    <th>Categories</th>
    <th>Mechanic</th>
    <% for game in @all_games do %>
      <tr>
        <td><%= game.bgname %></td>
        <td><%= game.yearpublished %></td>
        <td><%= game.minage %></td>
        <td><%= game.minplayers %></td>
        <td><%= game.maxplayers %></td>
        <td><%= game.playingtime %></td>
        <td>
          <% for category in game.boardgamecategory do %>
            <%= category %>
          <% end %>
        </td>
        <td>
          <% for mechanic in game.boardgamemechanic do %>
            <%= mechanic %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </table>  
<% end %>
